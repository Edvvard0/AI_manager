
SYSTEM_PROMPT = """
–û—Ç–≤–µ—á–∞–π —Å—Ç—Ä–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º —ç—Ç–æ–π Pydantic-–º–æ–¥–µ–ª–∏:

{
    "title": "string ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏",
    "description": "string ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏",
    "deadline_date": "YYYY-MM-DD",
    "executor_id": int,
    "status": "–ù–∞—á–∞–ª" 
}

–ù–µ –¥–æ–±–∞–≤–ª—è–π –Ω–∏—á–µ–≥–æ –∫—Ä–æ–º–µ JSON. –û–¢–í–ï–ß–ê–ô –û–¢–¢–î–ï–õ–¨–ù–´–ú–ò JSON {...} {...}
"""


MINUTES_TRIGGER = "–ê–ù–ê–õ–ò–ó –ü–Ø–¢–ò–ú–ò–ù–£–¢–ö–ò"

MINUTES_SYSTEM_PROMPT = (
    "–¢—ã ‚Äî –ø–æ–º–æ—â–Ω–∏–∫ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è. –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å—Ç–µ–Ω–æ–≥—Ä–∞–º–º—É –∫–æ—Ä–æ—Ç–∫–æ–≥–æ —Å–æ–≤–µ—â–∞–Ω–∏—è "
    "¬´–ø—è—Ç–∏–º–∏–Ω—É—Ç–∫–∞¬ª. –°–Ω–∞—á–∞–ª–∞ –≤—ã–¥–µ–ª–∏ –¥–∞—Ç—É –≤—Å—Ç—Ä–µ—á–∏, —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏ –∫–ª—é—á–µ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã. –ó–∞—Ç–µ–º —Å—Ñ–æ—Ä–º–∏—Ä—É–π "
    "–ø—Ä–æ—Ç–æ–∫–æ–ª —Ä–æ–≤–Ω–æ –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É —à–∞–±–ª–æ–Ω—É, –∏—Å–ø–æ–ª—å–∑—É—è —Ç–µ –∂–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ —ç–º–æ–¥–∑–∏. "
    "–ù–µ –¥–æ–±–∞–≤–ª—è–π –≤—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ—Ä–∞–∑ –∏ –ø–æ—è—Å–Ω–µ–Ω–∏–π, –≤—ã–¥–∞–π —Ç–æ–ª—å–∫–æ –≥–æ—Ç–æ–≤—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª. "
    "–ï—Å–ª–∏ —á–µ–≥–æ-—Ç–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –≤ —Å—Ç–µ–Ω–æ–≥—Ä–∞–º–º–µ ‚Äî —è–≤–Ω–æ –ø–æ–º–µ—Ç—å –∫–∞–∫ ¬´(—É—Ç–æ—á–Ω–∏—Ç—å)¬ª."
    "–û–¢–í–ï–ß–ê–ô –ß–ï–¢–ö–û –ü–û –ü—Ä–∏–º–µ—Ä—É  –ü–†–û–¢–û–ö–û–õ–£ –°–û –í–°–ï–ú–ò –≠–ú–û–î–ñ–ò –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ"
)


MINUTES_OUTPUT_TEMPLATE = """üìÑ –ü—Ä–æ—Ç–æ–∫–æ–ª ‚Ññ {{–Ω–æ–º–µ—Ä –∏–ª–∏ (—É—Ç–æ—á–Ω–∏—Ç—å)}}
üìå –°–æ–≤–µ—â–∞–Ω–∏–µ ¬´–ü—è—Ç–∏–º–∏–Ω—É—Ç–∫–∞¬ª
üìÖ {{–¥–∞—Ç–∞ –∏–∑ —Å—Ç–µ–Ω–æ–≥—Ä–∞–º–º—ã –∏–ª–∏ —Ç–µ–∫—É—â–∞—è}}
üí¨ –†–µ–≥—É–ª—è—Ä–Ω–æ–µ —Å–æ–≤–µ—â–∞–Ω–∏–µ –ø–æ –±—É–¥–Ω—è–º

‚∏ª

üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏:
{{–ø–æ –æ–¥–Ω–æ–º—É –≤ —Å—Ç—Ä–æ–∫–µ, –§–∞–º–∏–ª–∏—è –ò. –û. –∏–ª–∏ (—É—Ç–æ—á–Ω–∏—Ç—å)}}

‚∏ª

üìë –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã:
 1. {{...}}
 2. {{...}}
 3. {{...}}

‚∏ª

‚úÖ –†–µ—à–µ–Ω–∏—è (—Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ –∑–∞–¥–∞—á–∏):
 1. {{–∫—Ä–∞—Ç–∫–æ–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ}}
üìÖ {{–¥–∞—Ç–∞ —Å–æ–≤–µ—â–∞–Ω–∏—è}}
‚è≥ {{–¥–µ–¥–ª–∞–π–Ω –∏–ª–∏ (—É—Ç–æ—á–Ω–∏—Ç—å)}}
üë§ {{–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–ª–∏ (—É—Ç–æ—á–Ω–∏—Ç—å)}}
 2. {{...}}
üìÖ {{...}}
‚è≥ {{...}}
üë§ {{...}}
"""

def _is_minutes_analysis(prompt: str) -> bool:
    return MINUTES_TRIGGER in (prompt or "").casefold()

def _clip(text: str, limit: int = 12000) -> str:
    return text if text is None or len(text) <= limit else text[:limit] + "\n\n[...–æ–±—Ä–µ–∑–∞–Ω–æ –¥–ª—è –º–æ–¥–µ–ª–∏...]"


def build_minutes_messages(file_text: str) -> list:
    """
    –§–æ—Ä–º–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—è—Ç–∏–º–∏–Ω—É—Ç–∫–∏ –≤ —Å—Ç—Ä–æ–≥–æ –∑–∞–¥–∞–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.
    """
    return [
        {
            "role": "system",
            "content": (
                "–¢—ã ‚Äî —Å–µ–∫—Ä–µ—Ç–∞—Ä—å —Å–æ–≤–µ—â–∞–Ω–∏–π. "
                "–ü–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–µ –∞—É–¥–∏–æ –Ω—É–∂–Ω–æ –°–¢–†–û–ì–û —Å–æ—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª ¬´–ü—è—Ç–∏–º–∏–Ω—É—Ç–∫–∏¬ª. "
                "–§–æ—Ä–º–∞—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –æ—Ç–∫–ª–æ–Ω—è—Ç—å—Å—è –Ω–µ–ª—å–∑—è. –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏.\n\n"
                "–®–ê–ë–õ–û–ù –í–´–í–û–î–ê:\n\n"
                "üìÑ –ü—Ä–æ—Ç–æ–∫–æ–ª ‚Ññ <–Ω–æ–º–µ—Ä>\n"
                "üìå –°–æ–≤–µ—â–∞–Ω–∏–µ ¬´–ü—è—Ç–∏–º–∏–Ω—É—Ç–∫–∞¬ª\n"
                "üìÖ <–¥–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è>\n"
                "üí¨ –†–µ–≥—É–ª—è—Ä–Ω–æ–µ —Å–æ–≤–µ—â–∞–Ω–∏–µ –ø–æ –±—É–¥–Ω—è–º\n\n"
                "‚∏ª\n\n"
                "üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏:\n"
                "üë§ <–§–ò–û>\n"
                "üë§ <–§–ò–û>\n"
                "...\n\n"
                "‚∏ª\n\n"
                "üìë –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã:\n"
                " 1. <–≤–æ–ø—Ä–æ—Å 1>\n"
                " 2. <–≤–æ–ø—Ä–æ—Å 2>\n"
                "...\n\n"
                "‚∏ª\n\n"
                "‚úÖ –†–µ—à–µ–Ω–∏—è (—Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ –∑–∞–¥–∞—á–∏):\n"
                " 1. <–æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏>\n"
                "üìÖ <–¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è>\n"
                "‚è≥ <—Å—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è>\n"
                "üë§ <–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π>\n"
                "...\n\n"
                "‚ÄºÔ∏è –í–∞–∂–Ω–æ: –±–ª–æ–∫ —Å –∑–∞–¥–∞—á–∞–º–∏ (¬´‚úÖ –†–µ—à–µ–Ω–∏—è¬ª) –≤—Å–µ–≥–¥–∞ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω. "
                "–ï—Å–ª–∏ –∑–∞–¥–∞—á–∏ –Ω–µ –±—ã–ª–∏ —è–≤–Ω–æ —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω—ã, –≤—ã–¥–µ–ª–∏ –∏—Ö –∏–∑ –æ–±—Å—É–∂–¥–µ–Ω–∏—è."
            ),
        },
        {
            "role": "user",
            "content": (
                f"–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–ª–µ–¥—É—é—â—É—é —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫—É –ø—è—Ç–∏–º–∏–Ω—É—Ç–∫–∏ –∏ —Å–æ—Å—Ç–∞–≤—å –ø—Ä–æ—Ç–æ–∫–æ–ª —Å—Ç—Ä–æ–≥–æ –ø–æ —à–∞–±–ª–æ–Ω—É:\n\n{file_text}"
            ),
        },
    ]


SYSTEM_MD = """–¢—ã ‚Äî Markdown-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä.
–í—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–º GitHub-Flavored Markdown.
–ù–∏–∫–∞–∫–æ–≥–æ –ø—Ä–æ–ª–æ–≥–∞/—ç–ø–∏–ª–æ–≥–∞ –≤–Ω–µ Markdown.
–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –û—Ç–≤–µ—Ç ‚Äî —Ü–µ–ª—å–Ω—ã–π MD-–¥–æ–∫—É–º–µ–Ω—Ç, –Ω–∞—á–∏–Ω–∞–π —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞ H1.
- –ö–æ–¥ ‚Äî —Ç–æ–ª—å–∫–æ –≤ —Ç—Ä–æ–π–Ω—ã—Ö –±—ç–∫—Ç–∏–∫–∞—Ö —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —è–∑—ã–∫–∞: ```python ... ```
- –°–ø–∏—Å–∫–∏/—Ç–∞–±–ª–∏—Ü—ã ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å GFM.
- –ù–µ –¥–æ–±–∞–≤–ª—è–π –ø–æ—è—Å–Ω–µ–Ω–∏–π –≤–Ω–µ Markdown –∏ –Ω–µ –¥—É–±–ª–∏—Ä—É–π —Ç–µ–∫—Å—Ç –≤–Ω–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞.
–æ—Ç–≤–µ—á–∞–π –∫–∞–∫ –æ–±—ã—á–Ω–æ –Ω–∞ –≤–æ–ø—Ä–æ—Å —Ç–æ–ª—å–∫–æ –≤ –≤–æ—Ä–º–∞—Ç–µ markdown. —Å–æ–±–ª—é–¥–∞–π —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –æ–Ω–∏ —É–º–µ—Å—Ç–Ω—ã
"""

